# Better Query CLI

The Better Query CLI provides commands to initialize new projects and generate TypeScript types automatically.

## Installation

Install Better Query globally to use the CLI:

```bash
npm install -g better-query
# or
pnpm add -g better-query
# or
yarn global add better-query
```

Alternatively, use it directly with npx:

```bash
npx better-query <command>
```

## Commands

### `init` - Initialize New Project

Creates a new Better Query project with your chosen framework and configuration.

```bash
better-query init [options]
```

**Options:**

- `--with-auth` - Include Better Auth integration
- `--framework <framework>` - Framework to use (nextjs, express, hono) (default: "nextjs")
- `--database <database>` - Database to use (sqlite, postgres, mysql) (default: "sqlite")
- `--dir <directory>` - Target directory (default: ".")
- `--typescript` - Use TypeScript (default: true)

**Examples:**

```bash
# Create a basic Next.js project with SQLite
npx better-query init

# Create a Next.js project with Better Auth integration
npx better-query init --with-auth

# Create a project in a specific directory
npx better-query init --dir my-app --with-auth

# Create a project with PostgreSQL
npx better-query init --with-auth --database postgres
```

**Generated Project Structure:**

```
my-app/
├── README.md
├── package.json
├── next.config.mjs
├── tsconfig.json
├── tailwind.config.js
├── .gitignore
├── .env.local
├── public/
├── src/
│   ├── app/
│   │   ├── globals.css
│   │   ├── layout.tsx
│   │   ├── page.tsx
│   │   └── api/
│   │       ├── query/
│   │       │   └── [...any]/
│   │       │       └── route.ts
│   │       └── auth/          # Only with --with-auth
│   │           └── [...all]/
│   │               └── route.ts
│   ├── lib/
│   │   ├── query.ts           # Better Query configuration
│   │   ├── client.ts          # Type-safe client setup
│   │   └── schemas.ts         # Zod schemas
│   └── components/
└── types/                     # Generated types (after running generate)
```

### `generate` - Generate TypeScript Types

Generates TypeScript types from your Better Query configuration file.

```bash
better-query generate [options]
```

**Aliases:** `gen`

**Options:**

- `--config <path>` - Path to Better Query config file (default: "./lib/query.ts")
- `--output <path>` - Output file for generated types (default: "./types/generated.ts")
- `--watch` - Watch for changes and regenerate types (coming soon)

**Examples:**

```bash
# Generate types with default paths
better-query generate

# Generate types from custom config file
better-query generate --config ./src/config/query.ts

# Generate types to custom output file
better-query generate --config ./lib/query.ts --output ./src/types/api.ts
```

**Generated Types Example:**

```typescript
// Generated by Better Query CLI
// Do not edit this file manually

export interface QueryClient {
  product: {
    create: (data: CreateProductInput) => Promise<Product>;
    update: (id: string, data: UpdateProductInput) => Promise<Product>;
    delete: (id: string) => Promise<void>;
    findById: (id: string) => Promise<Product | null>;
    list: (params?: ListParams) => Promise<ListResult<Product>>;
  };
  // ... other resources
}

export interface ListParams {
  page?: number;
  limit?: number;
  search?: string;
  sort?: string;
  order?: 'asc' | 'desc';
}

export interface ListResult<T> {
  data: T[];
  total: number;
  page: number;
  limit: number;
  hasMore: boolean;
}

// ... type definitions for each resource
```

## Framework Templates

### Next.js Template

The Next.js template creates a complete Next.js application with:

- **App Router** setup with API routes
- **TypeScript** configuration
- **Tailwind CSS** for styling
- **Better Query** integration with sample resources
- **Better Auth** integration (when using `--with-auth`)
- **Sample schemas** (Product, Category)
- **Type-safe client** setup
- **Environment configuration**

#### With Better Auth (`--with-auth`)

When using the `--with-auth` flag, the generated project includes:

- Better Auth configuration in `src/lib/query.ts`
- Authentication API routes at `/api/auth/[...all]`
- Role-based permissions in Better Query
- Session management setup
- Environment variables for auth secrets

#### Database Support

The CLI supports multiple database providers:

- **SQLite** (default) - Perfect for development and simple deployments
- **PostgreSQL** - Production-ready relational database
- **MySQL** - Popular relational database choice

## Development Workflow

### 1. Initialize Project

```bash
npx better-query init --with-auth --dir my-project
cd my-project
```

### 2. Install Dependencies

```bash
npm install
```

### 3. Configure Environment

Edit `.env.local`:

```bash
# Database
DATABASE_URL=sqlite:./data.db

# Better Query
NEXT_PUBLIC_API_URL=http://localhost:3000/api/query

# Better Auth (if using --with-auth)
BETTER_AUTH_SECRET=your-secret-key-here-change-in-production
BETTER_AUTH_URL=http://localhost:3000
```

### 4. Generate Types (Optional)

```bash
npm run generate:types
# or
npx better-query generate
```

### 5. Start Development

```bash
npm run dev
```

Your app will be available at http://localhost:3000

## Best Practices

### Project Structure

- Keep your Better Query configuration in `src/lib/query.ts`
- Define schemas in `src/lib/schemas.ts`
- Use the generated client from `src/lib/client.ts`
- Generate types regularly with `npm run generate:types`

### Type Safety

- Always use the generated types for your API calls
- Regenerate types after modifying resources or schemas
- Import types from the generated file, not manually defined interfaces

### Environment Variables

- Never commit secrets to version control
- Use different `.env` files for different environments
- Set `BETTER_AUTH_SECRET` to a secure random string in production

### Database

- Use SQLite for development and prototyping
- Switch to PostgreSQL or MySQL for production
- Enable auto-migration in development, disable in production

## Troubleshooting

### CLI Not Found

If you get "command not found", make sure Better Query is installed globally:

```bash
npm list -g better-query
# If not found, install globally:
npm install -g better-query
```

### Permission Errors

If you get permission errors during project generation, ensure you have write permissions in the target directory.

### Type Generation Fails

If type generation fails:

1. Ensure your Better Query config file exists at the specified path
2. Check that your config file exports a `betterQuery` instance
3. Verify your resource configurations are valid

### Build Errors in Generated Project

If the generated project has build errors:

1. Run `npm install` to ensure all dependencies are installed
2. Check your `.env.local` file for required environment variables
3. Ensure your database URL is correct and accessible

## Contributing

To contribute to the Better Query CLI:

1. Clone the repository
2. Navigate to `packages/better-query`
3. Make your changes in the `src/cli/` directory
4. Test your changes with `npm run build && node dist/cli.js`
5. Submit a pull request

The CLI code is organized as follows:

- `src/cli/index.ts` - Main CLI entry point
- `src/cli/commands/` - Individual command implementations
- `src/cli/templates/` - Project templates and generators
- `src/cli/utils/` - Utility functions and helpers